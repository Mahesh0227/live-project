<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student List - MR Technologies</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <style>
    :root {
      --primary-color: #113C71;
      --secondary-color: #f8f9fc;
      --accent-color: #03306e;
      --success-color: #16a34a;
      --danger-color: #dc2626;
      --text-color: #333333;
      --muted-text: #6b7280;
      --white: #ffffff;
      --font-base: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --transition-speed: 0.3s;
      --card-radius: 12px;
      --shadow-elevation: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-base);
    }

    body {
      background-color: #f0f0f0;
    }

    @keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.row-animate {
  animation: fadeSlideIn 0.4s ease-in-out;
}

  </style>
</head>
<!-- hello -->
<body class="min-h-screen flex flex-col">

<!-- Top Bar -->
<header class="flex justify-between items-center bg-white shadow-md p-3 fixed top-0 left-0 right-0 z-50">
  <div class="flex items-center gap-4">
    <img src="/images/logo.jpg" alt="MR Technologies Logo" class="h-16 object-contain">
    <h1 class="text-2xl font-bold text-[var(--primary-color)]">Batches</h1>
  </div>
  <p class="text-sm text-gray-600">
    Welcome, <span class="font-semibold text-[var(--primary-color)]" id="username">Loading...</span>
  </p>
</header>

<!-- Page Layout -->
<div class="flex flex-1 pt-20">
  <!-- Sidebar -->
 <aside class="fixed top-[80px] left-0 w-72 bg-[var(--primary-color)] text-white " style="height: calc(100% - 80px); padding-top: 10px; z-index: 30; font-size: 20px;">
    <nav class="flex flex-col gap-4" style="margin-top: 10%;margin-left: 10%;">
      <a href="/dashboard" class="p-3 rounded slide-link">Dashboard</a>
      <a href="/courses" class="p-3 rounded slide-link">Courses</a>
      <a href="/studenthome" class="p-3 rounded slide-link">Students</a>
      <a href="/Batch" class="p-3 rounded slide-link">Batch</a>
      <a href="/payments" class="p-3 rounded slide-link">Payments</a>
      <a href="/reports" class="p-3 rounded slide-link">Reports</a>
    </nav>
    <button onclick="logout()" class="mt-4 text-left text-red-300 hover:text-white p-3 transition" style="margin-left: 10%;">Logout</button>
  </aside> 

 <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-2xl p-6 border border-gray-100" style="margin-top: 5rem; margin-left: 17rem; width: 100%;">
  <!-- Title -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-3xl font-extrabold text-indigo-800 flex items-center gap-2">
        <i class="fas fa-user-graduate text-indigo-600"></i> Student List
      </h2>
      <h3 class="text-lg font-semibold text-gray-700 mt-2 flex items-center gap-2">
        <i class="fas fa-users text-indigo-500"></i> Total Students:
        <span class="text-2xl font-bold text-indigo-700" th:text="${totalStudents}">0</span>
      </h3>
    </div>
  </div>
  <div id="pagination" class="mt-6 flex justify-center items-center space-x-2 text-sm">
    <button class="page-btn px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-all duration-200 shadow-sm">
      <i class="fas fa-angle-double-left"></i>
    </button>
    <button class="page-btn px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all duration-200 shadow-sm">1</button>
    <button class="page-btn px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-all duration-200 shadow-sm">2</button>
    <button class="page-btn px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-all duration-200 shadow-sm">3</button>
    <button class="page-btn px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-all duration-200 shadow-sm">
      <i class="fas fa-angle-double-right"></i>
    </button>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
    <table class="min-w-full text-sm">
      <thead class="bg-gradient-to-r from-indigo-100 to-indigo-200">
        <tr>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">ID</th>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">Name</th>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">Email</th>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">Mobile</th>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">Course</th>
          <th class="px-4 py-3 text-left font-semibold text-indigo-800 uppercase tracking-wide">Actions</th>
        </tr>
      </thead>
      <tbody id="studentTable" class="divide-y divide-gray-100">
        <!-- Example Row -->
        <tr class="row-animate hover:bg-indigo-50 transition-all duration-200 ease-in-out">
          <td class="px-4 py-3">1</td>
          <td class="px-4 py-3">John Doe</td>
          <td class="px-4 py-3">john@example.com</td>
          <td class="px-4 py-3">9876543210</td>
          <td class="px-4 py-3">Java Full Stack</td>
          <td class="px-4 py-3 space-x-3">
            <button class="text-green-600 hover:text-green-800 transition duration-200" title="View">
              <i class="fas fa-eye"></i>
            </button>
            <button class="text-blue-600 hover:text-blue-800 transition duration-200" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="text-red-600 hover:text-red-800 transition duration-200" title="Delete">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  
</div>

<script>
  let allStudents = [];
  let currentPage = 1;
  const studentsPerPage = 5;

  function editStudent(studentId) {
    window.location.href = "/student/edit/" + studentId;
  }

  function deleteStudent(id) {
    if (!confirm("Are you sure you want to delete this student?")) return;

    fetch(`http://localhost:8080/api/students/${id}`, {
      method: "DELETE"
    })
    .then(res => {
      if (!res.ok) throw new Error("Failed to delete");
      alert("✅ Student deleted successfully");
      fetchStudents(); // Reload data
    })
    .catch(err => alert("❌ Error: " + err.message));
  }

  function fetchStudents() {
    fetch("http://localhost:8080/api/students/getstudents")
      .then(res => res.json())
      .then(data => {
        allStudents = data;
        renderStudents();
        renderPaginationButtons();
      })
      .catch(err => alert("❌ Failed to load students: " + err.message));
  }
    // pagination 
  function renderStudents() {
    const tbody = document.getElementById("studentTable");
    tbody.innerHTML = "";

    const start = (currentPage - 1) * studentsPerPage;  //to display the students at the starting page 
    const end = start + studentsPerPage;  // to display the students at the ending page 
    const currentStudents = allStudents.slice(start, end);

    currentStudents.forEach(student => {
      const row = document.createElement("tr");
      row.className = "row-animate hover:bg-indigo-50 transition-all duration-200 ease-in-out";
      row.innerHTML = `
        <td class="px-4 py-2">${student.id}</td>
        <td class="px-4 py-2">${student.name}</td>
        <td class="px-4 py-2">${student.email}</td>
        <td class="px-4 py-2">${student.mobile}</td>
        <td class="px-4 py-2">${student.course}</td>
        <td class="px-4 py-2 space-x-2">
          <button onclick="editStudent(${student.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 text-sm rounded">Edit</button>
          <button onclick="deleteStudent(${student.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 text-sm rounded">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  function renderPaginationButtons() {
	  const paginationDiv = document.getElementById("pagination");
	  paginationDiv.innerHTML = "";

	  const totalPages = Math.ceil(allStudents.length / studentsPerPage);  // total students / per page students count

	  // First Page
	  const firstBtn = document.createElement("button");
	  firstBtn.innerHTML = "&laquo;";
	  firstBtn.disabled = currentPage === 1;
	  firstBtn.className = "page-btn bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-medium px-3 py-1 rounded-lg shadow-sm transition-all duration-200";
	  firstBtn.onclick = () => {
	    currentPage = 1;
	    renderStudents();
	    renderPaginationButtons();
	  };
	  paginationDiv.appendChild(firstBtn);

	  // Previous Page
	  const prevBtn = document.createElement("button");
	  prevBtn.innerHTML = "&lt;";
	  prevBtn.disabled = currentPage === 1;
	  prevBtn.className = "bg-gray-200 px-2 py-1 rounded hover:bg-gray-300";
	  prevBtn.onclick = () => {
	    if (currentPage > 1) {
	      currentPage--;
	      renderStudents();
	      renderPaginationButtons();
	    }
	  };
	  paginationDiv.appendChild(prevBtn);

	  // Page Number Input
	  const pageInput = document.createElement("input");
	  pageInput.type = "number";
	  pageInput.min = 1;
	  pageInput.max = totalPages;
	  pageInput.value = currentPage;
	 pageInput.className = "border border-gray-300 px-2 py-1 w-14 text-center rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none";
	  pageInput.onchange = () => {
	    const newPage = parseInt(pageInput.value);
	    if (newPage >= 1 && newPage <= totalPages) {
	      currentPage = newPage;
	      renderStudents();
	      renderPaginationButtons();
	    } else {
	      pageInput.value = currentPage; // reset invalid input
	    }
	  };
	  paginationDiv.appendChild(pageInput);

	  // Total Pages Text
	  const pageInfo = document.createElement("span");
	  pageInfo.textContent = ` of ${totalPages}`;
	  pageInfo.className = "text-gray-600";
	  paginationDiv.appendChild(pageInfo);

	  // Next Page
	  const nextBtn = document.createElement("button");
	  nextBtn.innerHTML = "&gt;";
	  nextBtn.disabled = currentPage === totalPages;
	  nextBtn.className = "bg-gray-200 px-2 py-1 rounded hover:bg-gray-300";
	  nextBtn.onclick = () => {
	    if (currentPage < totalPages) {
	      currentPage++;
	      renderStudents();
	      renderPaginationButtons();
	    }
	  };
	  paginationDiv.appendChild(nextBtn);

	  // Last Page
	  const lastBtn = document.createElement("button");
	  lastBtn.innerHTML = "&raquo;";
	  lastBtn.disabled = currentPage === totalPages;
	  lastBtn.className = "bg-gray-200 px-2 py-1 rounded hover:bg-gray-300";
	  lastBtn.onclick = () => {
	    currentPage = totalPages;
	    renderStudents();
	    renderPaginationButtons();
	  };
	  paginationDiv.appendChild(lastBtn);
	}

  // Fetch student count
  fetch("http://localhost:8080/api/students/count")
    .then(res => res.json())
    .then(count => {
      const countElement = document.querySelector(".text-2xl.mt-2");
      if (countElement) {
        countElement.textContent = count;
      }
    })
    .catch(err => console.error("❌ Failed to load count:", err));

  fetchStudents();
//USERNAME
  fetch("http://localhost:8080/api/username", {
      credentials: 'include' // ⬅ Important to send session cookie
    })
    .then(response => {
      if (!response.ok) throw new Error("Not logged in");
      return response.text();
    })
    .then(username => {
      document.getElementById("username").innerText = username;
    })
    .catch(() => {
      document.getElementById("username").innerText = "Guest";
    });
</script>



</body>
</html>
